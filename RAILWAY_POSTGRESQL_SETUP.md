# Railway PostgreSQL Setup Guide

## Problem
Railway uses **ephemeral storage** by default, which means your SQLite database gets wiped every time the container restarts. This causes all strategies generated by the autonomous agent to disappear.

## Solution
Set up PostgreSQL on Railway for persistent storage.

---

## Step-by-Step Setup

### 1. Add PostgreSQL to Your Railway Project

1. Go to your Railway dashboard: https://railway.app/dashboard
2. Click on your project (the one with your trading platform API)
3. Click the **"+ New"** button in the top right
4. Select **"Database" â†’ "Add PostgreSQL"**
5. Railway will create a new PostgreSQL service in your project

### 2. Get the Database URL

1. Click on the newly created **PostgreSQL** service
2. Go to the **"Variables"** tab
3. You'll see a variable called `DATABASE_URL` - this is automatically generated
4. **Copy this URL** (it looks like: `postgresql://postgres:password@containers-us-west-123.railway.app:7432/railway`)

### 3. Connect Your API to PostgreSQL

1. Click on your **main API service** (not the PostgreSQL service)
2. Go to the **"Variables"** tab
3. Click **"+ New Variable"**
4. Add:
   - **Name**: `DATABASE_URL`
   - **Value**: Paste the PostgreSQL URL you copied in Step 2
5. Click **"Add"**

### 4. Deploy the Changes

1. The updated `requirements-trading-platform.txt` now includes `psycopg2-binary` (PostgreSQL driver)
2. Commit and push your changes to GitHub:
   ```bash
   git add requirements-trading-platform.txt
   git commit -m "Add PostgreSQL support for persistent storage"
   git push
   ```
3. Railway will automatically redeploy your app with PostgreSQL support

### 5. Verify the Setup

1. Wait for the deployment to complete (check the **"Deployments"** tab)
2. Once deployed, go to your Streamlit app
3. Start the **Autonomous Learning Agent**
4. Let it generate a few strategies
5. Check the **Backtest Results** page - you should see the strategies
6. To verify persistence:
   - Go to Railway dashboard
   - Restart your API service manually
   - Check Backtest Results again - strategies should still be there!

---

## Database Migration

Your app will automatically create all necessary tables in PostgreSQL on first run. The `database.py` file already supports PostgreSQL:

```python
DATABASE_URL = os.getenv("DATABASE_URL", "sqlite:///./trading_platform.db")
```

When `DATABASE_URL` is set to a PostgreSQL connection string, SQLAlchemy will use PostgreSQL instead of SQLite.

---

## Environment Variables Summary

After setup, your Railway API service should have these environment variables:

| Variable | Value | Purpose |
|----------|-------|---------|
| `DATABASE_URL` | `postgresql://...` | PostgreSQL connection string |
| `OPENAI_API_KEY` | `sk-...` | Your OpenAI API key |
| `PORT` | `8000` | API server port (auto-set by Railway) |

---

## Troubleshooting

### "relation does not exist" error
- **Cause**: Tables not created yet
- **Fix**: Restart the API service to trigger table creation

### Connection timeout
- **Cause**: DATABASE_URL might be incorrect
- **Fix**: Verify the PostgreSQL URL in Variables tab matches exactly

### Strategies still disappearing
- **Cause**: DATABASE_URL might not be set on the API service
- **Fix**: Make sure you added DATABASE_URL to the **API service**, not just the PostgreSQL service

---

## Benefits of PostgreSQL

âœ… **Persistent Storage** - Data survives container restarts
âœ… **Better Performance** - Optimized for concurrent reads/writes
âœ… **Scalability** - Can handle more strategies and backtest results
âœ… **Reliability** - Automatic backups by Railway
âœ… **Production Ready** - Industry-standard database

---

## Next Steps

Once PostgreSQL is set up:

1. The autonomous agent will continuously learn and improve
2. All strategies will be permanently saved
3. Historical backtest data will accumulate over time
4. You can analyze long-term strategy performance trends

Your AI trading platform is now production-ready! ðŸš€
